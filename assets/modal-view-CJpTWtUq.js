import{E as y,c as _,d as V,p as w,L as W,f as T,e as z,C as E,T as v,S as I,G as k}from"./index-ByP46Rdr.js";import{g as b}from"./create-reactive-scope-BJRDMZKm.js";let F;function D(s){return F=s,s}function m(){return F}class C{static setParamValue(t,e){if(t.setValueAtTime){const i=m().context;t.setValueAtTime(e,i.audioContext.currentTime)}else t.value=e;return e}}class G extends y{constructor(){super(...arguments),this.speed=1,this.muted=!1,this.volume=1,this.paused=!1}refresh(){this.emit("refresh")}refreshPaused(){this.emit("refreshPaused")}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(t){console.warn("HTML Audio does not support filters")}get audioContext(){return console.warn("HTML Audio does not support audioContext"),null}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this.paused}destroy(){this.removeAllListeners()}}let Q=0;const L=class extends y{constructor(s){super(),this.id=Q++,this.init(s)}set(s,t){if(this[s]===void 0)throw new Error(`Property with name ${s} does not exist.`);switch(s){case"speed":this.speed=t;break;case"volume":this.volume=t;break;case"paused":this.paused=t;break;case"loop":this.loop=t;break;case"muted":this.muted=t;break}return this}get progress(){const{currentTime:s}=this._source;return s/this._duration}get paused(){return this._paused}set paused(s){this._paused=s,this.refreshPaused()}_onPlay(){this._playing=!0}_onPause(){this._playing=!1}init(s){this._playing=!1,this._duration=s.source.duration;const t=this._source=s.source.cloneNode(!1);t.src=s.parent.url,t.onplay=this._onPlay.bind(this),t.onpause=this._onPause.bind(this),s.context.on("refresh",this.refresh,this),s.context.on("refreshPaused",this.refreshPaused,this),this._media=s}_internalStop(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())}stop(){this._internalStop(),this._source&&this.emit("stop")}get speed(){return this._speed}set speed(s){this._speed=s,this.refresh()}get volume(){return this._volume}set volume(s){this._volume=s,this.refresh()}get loop(){return this._loop}set loop(s){this._loop=s,this.refresh()}get muted(){return this._muted}set muted(s){this._muted=s,this.refresh()}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(s){console.warn("HTML Audio does not support filters")}refresh(){const s=this._media.context,t=this._media.parent;this._source.loop=this._loop||t.loop;const e=s.volume*(s.muted?0:1),i=t.volume*(t.muted?0:1),o=this._volume*(this._muted?0:1);this._source.volume=o*e*i,this._source.playbackRate=this._speed*s.speed*t.speed}refreshPaused(){const s=this._media.context,t=this._media.parent,e=this._paused||t.paused||s.paused;e!==this._pausedReal&&(this._pausedReal=e,e?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",e))}play(s){const{start:t,end:e,speed:i,loop:o,volume:n,muted:a}=s;e&&console.assert(e>t,"End time is before start time"),this._speed=i,this._volume=n,this._loop=!!o,this._muted=a,this.refresh(),this.loop&&e!==null&&(console.warn('Looping not support when specifying an "end" time'),this.loop=!1),this._start=t,this._end=e||this._duration,this._start=Math.max(0,this._start-L.PADDING),this._end=Math.min(this._end+L.PADDING,this._duration),this._source.onloadedmetadata=()=>{this._source&&(this._source.currentTime=t,this._source.onloadedmetadata=null,this.emit("progress",t/this._duration,this._duration),_.shared.add(this._onUpdate,this))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")}_onUpdate(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()}_onComplete(){_.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)}destroy(){_.shared.remove(this._onUpdate,this),this.removeAllListeners();const s=this._source;s&&(s.onended=null,s.onplay=null,s.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)}toString(){return`[HTMLAudioInstance id=${this.id}]`}};let O=L;O.PADDING=.1;class j extends y{init(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)}create(){return new O(this)}get isPlayable(){return!!this._source&&this._source.readyState===4}get duration(){return this._source.duration}get context(){return this.parent.context}get filters(){return null}set filters(t){console.warn("HTML Audio does not support filters")}destroy(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)}get source(){return this._source}load(t){const e=this._source,i=this.parent;if(e.readyState===4){i.isLoaded=!0;const u=i.autoPlayStart();t&&setTimeout(()=>{t(null,i,u)},0);return}if(!i.url){t(new Error("sound.url or sound.source must be set"));return}e.src=i.url;const o=()=>{r(),i.isLoaded=!0;const u=i.autoPlayStart();t&&t(null,i,u)},n=()=>{r(),t&&t(new Error("Sound loading has been aborted"))},a=()=>{r();const u=`Failed to load audio element (code: ${e.error.code})`;t?t(new Error(u)):console.error(u)},r=()=>{e.removeEventListener("canplaythrough",o),e.removeEventListener("load",o),e.removeEventListener("abort",n),e.removeEventListener("error",a)};e.addEventListener("canplaythrough",o,!1),e.addEventListener("load",o,!1),e.addEventListener("abort",n,!1),e.addEventListener("error",a,!1),e.load()}}class Z{constructor(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start,console.assert(this.duration>0,"End time must be after start time")}play(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})}destroy(){this.parent=null}}const A=["ogg","oga","opus","m4a","mp3","mpeg","wav","aiff","wma","mid","caf"],q=["audio/mpeg","audio/ogg"],P={};function J(s){const t={m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"'},e=document.createElement("audio"),i={},o=/^no$/;A.forEach(n=>{const a=e.canPlayType(`audio/${n}`).replace(o,""),r=t[n]?e.canPlayType(t[n]).replace(o,""):"";i[n]=!!a||!!r}),Object.assign(P,i)}J();let K=0;class X extends y{constructor(t){super(),this.id=K++,this._media=null,this._paused=!1,this._muted=!1,this._elapsed=0,this.init(t)}set(t,e){if(this[t]===void 0)throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"muted":this.muted=e;break;case"loop":this.loop=e;break;case"paused":this.paused=e;break}return this}stop(){this._source&&(this._internalStop(),this.emit("stop"))}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh(),this._update(!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get filters(){return this._filters}set filters(t){var e;this._filters&&((e=this._filters)==null||e.filter(i=>i).forEach(i=>i.disconnect()),this._filters=null,this._source.connect(this._gain)),this._filters=t!=null&&t.length?t.slice(0):null,this.refresh()}refresh(){if(!this._source)return;const t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;const i=t.volume*(t.muted?0:1),o=e.volume*(e.muted?0:1),n=this._volume*(this._muted?0:1);C.setParamValue(this._gain.gain,n*o*i),C.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed),this.applyFilters()}applyFilters(){var t;if((t=this._filters)!=null&&t.length){this._source.disconnect();let e=this._source;this._filters.forEach(i=>{e.connect(i.destination),e=i}),e.connect(this._gain)}}refreshPaused(){const t=this._media.context,e=this._media.parent,i=this._paused||e.paused||t.paused;i!==this._pausedReal&&(this._pausedReal=i,i?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",i))}play(t){const{start:e,end:i,speed:o,loop:n,volume:a,muted:r,filters:u}=t;i&&console.assert(i>e,"End time is before start time"),this._paused=!1;const{source:h,gain:l}=this._media.nodes.cloneBufferSource();this._source=h,this._gain=l,this._speed=o,this._volume=a,this._loop=!!n,this._muted=r,this._filters=u,this.refresh();const d=this._source.buffer.duration;this._duration=d,this._end=i,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=i,this._source.loopStart=e,this._source.start(0,e)):i?this._source.start(0,e,i-e):this._source.start(0,e),this.emit("start"),this._update(!0),this.enableTicker(!0)}enableTicker(t){_.shared.remove(this._updateListener,this),t&&_.shared.add(this._updateListener,this)}get progress(){return this._progress}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}destroy(){var t;this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),(t=this._filters)==null||t.forEach(e=>e.disconnect()),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1}toString(){return`[WebAudioInstance id=${this.id}]`}_now(){return this._media.context.audioContext.currentTime}_updateListener(){this._update()}_update(t=!1){if(this._source){const e=this._now(),i=e-this._lastUpdate;if(i>0||t){const o=this._source.playbackRate.value;this._elapsed+=i*o,this._lastUpdate=e;const n=this._duration;let a;if(this._source.loopStart){const r=this._source.loopEnd-this._source.loopStart;a=(this._source.loopStart+this._elapsed%r)/n}else a=this._elapsed%n/n;this._progress=a,this.emit("progress",this._progress,n)}}}init(t){this._media=t,t.context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)}_internalStop(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null}}_onComplete(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)}}class ${constructor(t,e){this._output=e,this._input=t}get destination(){return this._input}get filters(){return this._filters}set filters(t){if(this._filters&&(this._filters.forEach(e=>{e&&e.disconnect()}),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();let e=null;t.forEach(i=>{e===null?this._input.connect(i.destination):e.connect(i.destination),e=i}),e.connect(this._output)}}destroy(){this.filters=null,this._input=null,this._output=null}}const R=class extends ${constructor(s){const t=s.audioContext,e=t.createBufferSource(),i=t.createGain(),o=t.createAnalyser();e.connect(o),o.connect(i),i.connect(s.destination),super(o,i),this.context=s,this.bufferSource=e,this.gain=i,this.analyser=o}get script(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(R.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script}destroy(){super.destroy(),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null}cloneBufferSource(){const s=this.bufferSource,t=this.context.audioContext.createBufferSource();t.buffer=s.buffer,C.setParamValue(t.playbackRate,s.playbackRate.value),t.loop=s.loop;const e=this.context.audioContext.createGain();return t.connect(e),e.connect(this.destination),{source:t,gain:e}}get bufferSize(){return this.script.bufferSize}};let U=R;U.BUFFER_SIZE=0;class Y{init(t){this.parent=t,this._nodes=new U(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source}destroy(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null,this.source=null}create(){return new X(this)}get context(){return this.parent.context}get isPlayable(){return!!this._source&&!!this._source.buffer}get filters(){return this._nodes.filters}set filters(t){this._nodes.filters=t}get duration(){return console.assert(this.isPlayable,"Sound not yet playable, no duration"),this._source.buffer.duration}get buffer(){return this._source.buffer}set buffer(t){this._source.buffer=t}get nodes(){return this._nodes}load(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t?t(new Error("sound.url or sound.source must be set")):console.error("sound.url or sound.source must be set")}async _loadUrl(t){const e=this.parent.url,i=await V.get().fetch(e);this._decode(await i.arrayBuffer(),t)}_decode(t,e){const i=(o,n)=>{if(o)e&&e(o);else{this.parent.isLoaded=!0,this.buffer=n;const a=this.parent.autoPlayStart();e&&e(null,this.parent,a)}};t instanceof AudioBuffer?i(null,t):this.parent.context.decode(t,i)}}const f=class{static from(s){let t={};typeof s=="string"?t.url=s:s instanceof ArrayBuffer||s instanceof AudioBuffer||s instanceof HTMLAudioElement?t.source=s:Array.isArray(s)?t.url=s:t=s,t={autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1,...t},Object.freeze(t);const e=m().useLegacy?new j:new Y;return new f(e,t)}constructor(s,t){this.media=s,this.options=t,this._instances=[],this._sprites={},this.media.init(this);const e=t.complete;this._autoPlayOptions=e?{complete:e}:null,this.isLoaded=!1,this._preloadQueue=null,this.isPlaying=!1,this.autoPlay=t.autoPlay,this.singleInstance=t.singleInstance,this.preload=t.preload||this.autoPlay,this.url=Array.isArray(t.url)?this.preferUrl(t.url):t.url,this.speed=t.speed,this.volume=t.volume,this.loop=t.loop,t.sprites&&this.addSprites(t.sprites),this.preload&&this._preload(t.loaded)}preferUrl(s){const[t]=s.map(e=>({url:e,ext:w.extname(e).slice(1)})).filter(({ext:e})=>P[e]).sort((e,i)=>A.indexOf(e.ext)-A.indexOf(i.ext));if(!t)throw new Error("No supported file type found");return t.url}get context(){return m().context}pause(){return this.isPlaying=!1,this.paused=!0,this}resume(){return this.isPlaying=this._instances.length>0,this.paused=!1,this}get paused(){return this._paused}set paused(s){this._paused=s,this.refreshPaused()}get speed(){return this._speed}set speed(s){this._speed=s,this.refresh()}get filters(){return this.media.filters}set filters(s){this.media.filters=s}addSprites(s,t){if(typeof s=="object"){const i={};for(const o in s)i[o]=this.addSprites(o,s[o]);return i}console.assert(!this._sprites[s],`Alias ${s} is already taken`);const e=new Z(this,t);return this._sprites[s]=e,e}destroy(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null}removeSprites(s){if(s){const t=this._sprites[s];t!==void 0&&(t.destroy(),delete this._sprites[s])}else for(const t in this._sprites)this.removeSprites(t);return this}get isPlayable(){return this.isLoaded&&this.media&&this.media.isPlayable}stop(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(let s=this._instances.length-1;s>=0;s--)this._instances[s].stop();return this}play(s,t){let e;if(typeof s=="string"?e={sprite:s,loop:this.loop,complete:t}:typeof s=="function"?(e={},e.complete=s):e=s,e={complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1,...e||{}},e.sprite){const o=e.sprite;console.assert(!!this._sprites[o],`Alias ${o} is not available`);const n=this._sprites[o];e.start=n.start+(e.start||0),e.end=n.end,e.speed=n.speed||1,e.loop=n.loop||e.loop,delete e.sprite}if(e.offset&&(e.start=e.offset),!this.isLoaded)return this._preloadQueue?new Promise(o=>{this._preloadQueue.push(()=>{o(this.play(e))})}):(this._preloadQueue=[],this.autoPlay=!0,this._autoPlayOptions=e,new Promise((o,n)=>{this._preload((a,r,u)=>{this._preloadQueue.forEach(h=>h()),this._preloadQueue=null,a?n(a):(e.loaded&&e.loaded(a,r,u),o(u))})}));(this.singleInstance||e.singleInstance)&&this._removeInstances();const i=this._createInstance();return this._instances.push(i),this.isPlaying=!0,i.once("end",()=>{e.complete&&e.complete(this),this._onComplete(i)}),i.once("stop",()=>{this._onComplete(i)}),i.play(e),i}refresh(){const s=this._instances.length;for(let t=0;t<s;t++)this._instances[t].refresh()}refreshPaused(){const s=this._instances.length;for(let t=0;t<s;t++)this._instances[t].refreshPaused()}get volume(){return this._volume}set volume(s){this._volume=s,this.refresh()}get muted(){return this._muted}set muted(s){this._muted=s,this.refresh()}get loop(){return this._loop}set loop(s){this._loop=s,this.refresh()}_preload(s){this.media.load(s)}get instances(){return this._instances}get sprites(){return this._sprites}get duration(){return this.media.duration}autoPlayStart(){let s;return this.autoPlay&&(s=this.play(this._autoPlayOptions)),s}_removeInstances(){for(let s=this._instances.length-1;s>=0;s--)this._poolInstance(this._instances[s]);this._instances.length=0}_onComplete(s){if(this._instances){const t=this._instances.indexOf(s);t>-1&&this._instances.splice(t,1),this.isPlaying=this._instances.length>0}this._poolInstance(s)}_createInstance(){if(f._pool.length>0){const s=f._pool.pop();return s.init(this.media),s}return this.media.create()}_poolInstance(s){s.destroy(),f._pool.indexOf(s)<0&&f._pool.push(s)}};let S=f;S._pool=[];class g extends ${constructor(){const t=window,e=new g.AudioContext,i=e.createDynamicsCompressor(),o=e.createAnalyser();o.connect(i),i.connect(e.destination),super(o,i),this.autoPause=!0,this._ctx=e,this._offlineCtx=new g.OfflineAudioContext(1,2,t.OfflineAudioContext?Math.max(8e3,Math.min(96e3,e.sampleRate)):44100),this.compressor=i,this.analyser=o,this.events=new y,this.volume=1,this.speed=1,this.muted=!1,this.paused=!1,this._locked=e.state==="suspended"&&("ontouchstart"in globalThis||"onclick"in globalThis),this._locked&&(this._unlock(),this._unlock=this._unlock.bind(this),document.addEventListener("mousedown",this._unlock,!0),document.addEventListener("touchstart",this._unlock,!0),document.addEventListener("touchend",this._unlock,!0)),this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this),globalThis.addEventListener("focus",this.onFocus),globalThis.addEventListener("blur",this.onBlur)}onFocus(){if(!this.autoPause)return;const t=this._ctx.state;(t==="suspended"||t==="interrupted"||!this._locked)&&(this.paused=this._pausedOnBlur,this.refreshPaused())}onBlur(){this.autoPause&&(this._locked||(this._pausedOnBlur=this._paused,this.paused=!0,this.refreshPaused()))}_unlock(){this._locked&&(this.playEmptySound(),this._ctx.state==="running"&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._locked=!1))}playEmptySound(){const t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),t.context.state==="suspended"&&t.context.resume()}static get AudioContext(){const t=window;return t.AudioContext||t.webkitAudioContext||null}static get OfflineAudioContext(){const t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null}destroy(){super.destroy();const t=this._ctx;typeof t.close<"u"&&t.close(),globalThis.removeEventListener("focus",this.onFocus),globalThis.removeEventListener("blur",this.onBlur),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null}get audioContext(){return this._ctx}get offlineContext(){return this._offlineCtx}set paused(t){t&&this._ctx.state==="running"?this._ctx.suspend():!t&&this._ctx.state==="suspended"&&this._ctx.resume(),this._paused=t}get paused(){return this._paused}refresh(){this.events.emit("refresh")}refreshPaused(){this.events.emit("refreshPaused")}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this._paused}decode(t,e){const i=n=>{e(new Error((n==null?void 0:n.message)||"Unable to decode file"))},o=this._offlineCtx.decodeAudioData(t,n=>{e(null,n)},i);o&&o.catch(i)}}class tt{constructor(){this.init()}init(){return this.supported&&(this._webAudioContext=new g),this._htmlAudioContext=new G,this._sounds={},this.useLegacy=!this.supported,this}get context(){return this._context}get filtersAll(){return this.useLegacy?[]:this._context.filters}set filtersAll(t){this.useLegacy||(this._context.filters=t)}get supported(){return g.AudioContext!==null}add(t,e){if(typeof t=="object"){const n={};for(const a in t){const r=this._getOptions(t[a],e);n[a]=this.add(a,r)}return n}if(console.assert(!this._sounds[t],`Sound with alias ${t} already exists.`),e instanceof S)return this._sounds[t]=e,e;const i=this._getOptions(e),o=S.from(i);return this._sounds[t]=o,o}_getOptions(t,e){let i;return typeof t=="string"?i={url:t}:Array.isArray(t)?i={url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?i={source:t}:i=t,i={...i,...e||{}},i}get useLegacy(){return this._useLegacy}set useLegacy(t){this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext}get disableAutoPause(){return!this._webAudioContext.autoPause}set disableAutoPause(t){this._webAudioContext.autoPause=!t}remove(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this}get volumeAll(){return this._context.volume}set volumeAll(t){this._context.volume=t,this._context.refresh()}get speedAll(){return this._context.speed}set speedAll(t){this._context.speed=t,this._context.refresh()}togglePauseAll(){return this._context.togglePause()}pauseAll(){return this._context.paused=!0,this._context.refreshPaused(),this}resumeAll(){return this._context.paused=!1,this._context.refreshPaused(),this}toggleMuteAll(){return this._context.toggleMute()}muteAll(){return this._context.muted=!0,this._context.refresh(),this}unmuteAll(){return this._context.muted=!1,this._context.refresh(),this}removeAll(){for(const t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this}stopAll(){for(const t in this._sounds)this._sounds[t].stop();return this}exists(t,e=!1){const i=!!this._sounds[t];return e&&console.assert(i,`No sound matching alias '${t}'.`),i}isPlaying(){for(const t in this._sounds)if(this._sounds[t].isPlaying)return!0;return!1}find(t){return this.exists(t,!0),this._sounds[t]}play(t,e){return this.find(t).play(e)}stop(t){return this.find(t).stop()}pause(t){return this.find(t).pause()}resume(t){return this.find(t).resume()}volume(t,e){const i=this.find(t);return e!==void 0&&(i.volume=e),i.volume}speed(t,e){const i=this.find(t);return e!==void 0&&(i.speed=e),i.speed}duration(t){return this.find(t).duration}close(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this}}const M=s=>{var i;const t=s.src;let e=(i=s==null?void 0:s.alias)==null?void 0:i[0];return(!e||s.src===e)&&(e=w.basename(t,w.extname(t))),e},et={extension:T.Asset,detection:{test:async()=>!0,add:async s=>[...s,...A.filter(t=>P[t])],remove:async s=>s.filter(t=>s.includes(t))},loader:{name:"sound",extension:{type:[T.LoadParser],priority:W.High},test(s){const t=w.extname(s).slice(1);return!!P[t]||q.some(e=>s.startsWith(`data:${e}`))},async load(s,t){const e=await new Promise((i,o)=>S.from({...t.data,url:s,preload:!0,loaded(n,a){var r,u;n?o(n):i(a),(u=(r=t.data)==null?void 0:r.loaded)==null||u.call(r,n,a)}}));return m().add(M(t),e),e},async unload(s,t){m().remove(M(t))}}};z.add(et);const p=D(new tt),st=["default","ui","gameplay","music"],it=()=>{const s=["default","ui","music"];let t=null;return{play:(r,u)=>{const{volume:h=.2,category:l="default"}=u||{volume:.2,category:"default"};p.context.paused||st.includes(l)&&s.includes(l)&&p.play(r,{volume:h,singleInstance:!0})},enableCategory:r=>{s.includes(r)||s.push(r)},disableCategory:r=>{const u=s.indexOf(r);u!==-1&&s.splice(u,1)},playMusic:async(r,u)=>{const{volume:h=.2}=u||{volume:.2};s.includes("music")&&(r="audio/mx/"+r,t!=null&&t.audioPath&&(p.stop(t.audioPath),t=null),t={audio:await p.play(r,{volume:h,loop:(u==null?void 0:u.loop)??!1}),audioPath:r},u!=null&&u.fadeIn?await b.to(t.audio,{volume:h,duration:.3}):t.audio.volume=h,u!=null&&u.fadeOut&&(u!=null&&u.duration)&&b.to(t.audio,{volume:0,delay:u.duration-.3,duration:.3}))},stopMusic:async r=>{const{fadeOut:u=!1}=r||{fadeOut:!1};t&&(u&&await b.to(t.audio,{volume:0,duration:.3}),t&&(p.stop(t.audioPath),t=null))}}},ot=it(),H=ot,ut=s=>{const{text:t,onClick:e}=s,i=s.borderSize??20,o=s.fontSize??64,n=new E;n.label=`${t}-ui-button`,n.eventMode="static";const a=new v;a.style={fontFamily:"alagard",fontSize:o,fontWeight:"bold",fill:"orange",align:"center",stroke:"black"},a.text=t,a.position.set(i,i);const r=I.from("text-background.png");r.label="button-background",r.width=a.width+i*2,r.height=a.height+i*2;const u=new k;return u.label="button-outline",u.rect(0,0,r.width,r.height),u.stroke({color:"black",width:6}),n.addChild(r,u,a),n.pivot.set(r.width*.5,r.height*.5),n.on("pointertap",()=>{if(e){H.play("audio/sfx/click.wav");const h={x:n.scale.x,y:n.scale.y};n.scale.set(h.x*.9,h.y*.9),setTimeout(()=>{n.scale.set(h.x,h.y)},115),setTimeout(()=>{e()},300)}}),n},B=s=>{const{spriteName:t,onClick:e}=s,{disableFlicker:i=!1}=s,o=s.onClickAudio??"select",n=s.alpha??.5,a=new E;a.label=`${t}-icon`,a.eventMode="static";const r=new k;r.circle(0,0,32),r.stroke({color:"khaki",width:4}),r.fill("khaki"),r.alpha=n,r.position.set(16,16),a.addChild(r);const u=I.from(`${t}.png`);return u.anchor.set(0),u.width=32,u.height=32,a.addChild(u),a.on("pointertap",()=>{e&&(e(),i||(r.alpha=1,b.delayedCall(.1,()=>r.alpha=n)),o!==""&&H.play(`audio/sfx/${o}.wav`,{category:"ui"}))}),a},at=({title:s,type:t,content:e,onClose:i,onConfirm:o,onCancel:n})=>{const a=new E,r=20;a.label="simple-modal",a.eventMode="static";const u=new v;u.text=s,u.style={fill:"white",fontSize:26,fontWeight:"bold",fontFamily:"alagard"},u.anchor.set(.5),u.position.set(0,0),a.addChild(u);const h=new v;h.style={fill:"white",fontSize:20,fontFamily:"alagard"},h.anchor.set(.5),h.text=t,h.position.set(0,u.height),a.addChild(h);const l=new v;l.text=e,l.style={fill:"white",fontSize:20,wordWrap:!0,wordWrapWidth:300,fontFamily:"alagard"},l.anchor.set(.5),l.position.set(0,h.y+h.height+l.height*.5),a.addChild(l);const d=B({spriteName:"confirm-icon",onClick:()=>{o&&o()}});d.position.set(l.x-l.width*.5+r*2,l.y+l.height+r),a.addChild(d);const c=B({spriteName:"cancel-icon",onClick:()=>{n&&n()}});c.position.set(l.x+l.width*.5-c.width-r,l.y+l.height+r),a.addChild(c),d.visible=o!==void 0,c.visible=n!==void 0;const N=d.visible?d.y+d.height:c.visible?c.y+c.height:l.y+l.height,x=new k;return x.rect(l.x-l.width*.5-r,u.y-u.height*.5-r,l.width+r*2,N+r*2),x.fill("maroon"),x.stroke({color:"black",width:3}),a.addChildAt(x,0),i&&a.on("pointertap",i),a};export{H as S,at as a,B as b,ut as c};
