import{l as L,a as O,b as G,c as N,d as $,e as V,f as W,G as v}from"./npc-model-DG3q-mtQ.js";import"./solid-lwVvZ318.js";const C=()=>{const f="1.0.44".split("."),c=`${f[0]}.${f[1]}`,r=`darkEarth-${c}-save`,l=`darkEarth-${c}-log`,n=`darkEarth-${c}-auto-save`,g=`darkEarth-${c}-auto-log`,p=()=>{console.debug("Clearing saved game...");try{const e=localStorage.getItem(l),a=localStorage.getItem(r);e&&localStorage.setItem(`${l}-backup`,e),a&&localStorage.setItem(`${r}-backup`,a)}catch{console.debug("Unable to backup saved game")}try{localStorage.removeItem(r),localStorage.removeItem(l),localStorage.removeItem(n),localStorage.removeItem(g),console.debug("Saved game cleared successfully.")}catch(e){console.error("Error clearing saved game:",e)}},S=(e=!1)=>{console.debug("Saving game log...");const a=v().log,o=JSON.stringify(a);try{localStorage.setItem(e?g:l,o)}catch(s){console.error("Error saving game log:",s)}},M=(e,a=!1)=>{console.debug("Saving game...");const{playerModel:o,npcModels:s,eventModels:d,settlementModels:m,tileModels:u,fogOfWarViewModel:i}=e,E=JSON.stringify({playerData:o.data(),npcData:s.map(t=>t.data()),eventData:d.map(t=>t.data()),settlementData:m.map(t=>t.data()),tileData:u.map(t=>t.map(k=>k.data())),fogOfWarData:i.data()});try{localStorage.setItem(a?n:r,E)}catch(t){console.error("Error saving game state:",t);return}S(a),console.debug("Game saved successfully.")},b=(e=!1)=>{console.debug("Loading game log...");const a=localStorage.getItem(e?g:l);if(!a){console.warn("No saved game log found.");return}try{const o=JSON.parse(a);v().load(o),console.debug("Game log loaded successfully.")}catch(o){console.error("Error loading game log:",o)}},y=()=>(console.debug("Checking if saved game exists..."),localStorage.getItem(r)?(console.debug("Saved game found."),!0):(console.debug("No saved game found."),!1)),D=()=>(console.debug("Checking if auto-saved game exists..."),localStorage.getItem(n)?(console.debug("Auto-saved game found."),!0):(console.debug("No auto-saved game found."),!1)),I=(e=!1)=>{console.debug("Loading game...");const a=localStorage.getItem(e?n:r);if(!a){console.warn("No saved game state found.");return}try{const o=JSON.parse(a),s=h(o);return console.debug("Game loaded successfully."),b(e),s}catch(o){console.error("Error loading game state:",o);return}},h=e=>{const a=L(e.playerData),o=e.npcData.map(O),s=e.eventData.map(G),d=e.settlementData.map(N),m=e.tileData.map(i=>i.map($)),u=V(e.fogOfWarData);return{playerModel:a,npcModels:o,eventModels:s,settlementModels:d,tileMapModel:W(m),fogOfWarViewModel:u}};return{save:M,load:I,clear:p,saveExists:y,autoSaveExists:D}};export{C as createSaveController};
