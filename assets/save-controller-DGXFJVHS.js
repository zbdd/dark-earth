import{l as L,a as O,b as N,c as G,d as $,e as V,f as W}from"./npc-model-DSebTk39.js";import{a as S}from"./index-DIE32vdq.js";import"./solid-lwVvZ318.js";const J=()=>{const f="1.1.3".split("."),c=`${f[0]}.${f[1]}`,s=`darkEarth-${c}-save`,l=`darkEarth-${c}-log`,n=`darkEarth-${c}-auto-save`,g=`darkEarth-${c}-auto-log`,M=()=>{console.debug("Clearing saved game...");try{const e=localStorage.getItem(l),a=localStorage.getItem(s);e&&localStorage.setItem(`${l}-backup`,e),a&&localStorage.setItem(`${s}-backup`,a)}catch{console.debug("Unable to backup saved game")}try{localStorage.removeItem(s),localStorage.removeItem(l),localStorage.removeItem(n),localStorage.removeItem(g),console.debug("Saved game cleared successfully.")}catch(e){console.error("Error clearing saved game:",e)}},v=(e=!1)=>{console.debug("Saving game log...");const a=S().log,o=JSON.stringify(a);try{localStorage.setItem(e?g:l,o)}catch(r){console.error("Error saving game log:",r)}},b=(e,a=!1)=>{console.debug("Saving game...");const{playerModel:o,npcModels:r,eventModels:d,settlementModels:m,tileModels:u,fogOfWarViewModel:i}=e,E=JSON.stringify({playerData:o.data(),npcData:r.map(t=>t.data()),eventData:d.map(t=>t.data()),settlementData:m.map(t=>t.data()),tileData:u.map(t=>t.map(k=>k.data())),fogOfWarData:i.data()});try{localStorage.setItem(a?n:s,E)}catch(t){console.error("Error saving game state:",t);return}v(a),console.debug("Game saved successfully.")},p=(e=!1)=>{console.debug("Loading game log...");const a=localStorage.getItem(e?g:l);if(!a){console.warn("No saved game log found.");return}try{const o=JSON.parse(a);S().load(o),console.debug("Game log loaded successfully.")}catch(o){console.error("Error loading game log:",o)}},y=()=>(console.debug("Checking if saved game exists..."),localStorage.getItem(s)?(console.debug("Saved game found."),!0):(console.debug("No saved game found."),!1)),D=()=>(console.debug("Checking if auto-saved game exists..."),localStorage.getItem(n)?(console.debug("Auto-saved game found."),!0):(console.debug("No auto-saved game found."),!1)),I=(e=!1)=>{console.debug("Loading game...");const a=localStorage.getItem(e?n:s);if(!a){console.warn("No saved game state found.");return}try{const o=JSON.parse(a),r=h(o);return console.debug("Game loaded successfully."),p(e),r}catch(o){console.error("Error loading game state:",o);return}},h=e=>{const a=L(e.playerData),o=e.npcData.map(O),r=e.eventData.map(N),d=e.settlementData.map(G),m=e.tileData.map(i=>i.map($)),u=V(e.fogOfWarData);return{playerModel:a,npcModels:o,eventModels:r,settlementModels:d,tileMapModel:W(m),fogOfWarViewModel:u}};return{save:b,saveLog:v,load:I,loadLog:p,clear:M,saveExists:y,autoSaveExists:D}};export{J as createSaveController};
