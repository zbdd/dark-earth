import{c as M,g as c,S as u}from"./sound-manager-BKtHbHDQ.js";import{C as w,G as j,S as d,T as I}from"./index-CjYlJhbG.js";import{a as P}from"./solid-lwVvZ318.js";const G=S=>{const{viewModel:i}=S,t=new w,h=new j,r=new w;let b=()=>{};r.label="loading-screen-screens-container",t.label="loading-screen-view",t.visible=!1,t.addChild(h,r),t.on("pointertap",()=>{b()});const a=d.from("load-level.jpg");a.label="loading-screen-sprite",a.visible=!i.isRestScreenVisible();const y=()=>{h.clear(),h.rect(0,0,innerWidth,innerHeight),h.fill("black")},f=d.from("game-over.jpg");f.label="game-over-sprite",f.visible=!1,r.addChild(f);const p=d.from("loading-screen-settlement.jpg");p.label="loading-screen-settlement-sprite",p.visible=i.isRestScreenVisible();const n=[d.from("intro-1.jpg"),d.from("intro-2.jpg"),d.from("intro-3.jpg"),d.from("intro-4.jpg")],s=new I;s.label="loading-screen-title",s.text=i.text(),s.style={fontFamily:"alagard",fontSize:48,fill:"#ffffff",align:"center",stroke:"#000000",dropShadow:!0},s.position.set(a.width*.5-s.width*.5,a.height*.2+s.height*.5),r.addChild(a,s,p),n.forEach((e,o)=>{e.label=`intro-screen-sprite-${o+1}`,e.visible=!1,r.addChild(e)});const x=()=>{i.isRestScreenVisible()?u.playMusic("mx-level-end.wav",{fadeIn:!0,fadeOut:!0}):i.isIntroSequencePlaying()&&u.playMusic("mx-intro.mp3",{fadeIn:!0,fadeOut:!0})},g=()=>{t.eventMode="static",t.alpha=0,t.visible=!0,c.fromTo(t,{alpha:0},{alpha:1,duration:p.visible?6:1,ease:"power2.inOut"})},m=async()=>{t.eventMode="none",n.slice(0,3).forEach(e=>e.visible=!1),n[3].visible&&await c.to(n[3],{alpha:0,duration:1,ease:"power2.inOut",onComplete:()=>{n[3].visible=!1}}),await c.to(t,{alpha:0,duration:1,ease:"power2.inOut",onComplete:()=>{t.visible=!1,s.text=""}})},v=(e,o)=>{y();const l=Math.min(e/a.width,o/a.height);r.scale.set(l),r.position.set((e-a.width*l)*.5,(o-a.height*l)*.5)},C=async e=>{s.text="";const o=e.split("");for(const l of o)s.text+=l,await new Promise(T=>setTimeout(T,100));await c.delayedCall(1,()=>{})},V=async()=>{for(const e of n){const o=n.indexOf(e);e.visible=!0,e.alpha=0,e.position.set((a.width-e.width)*.5,(a.height-e.height)*.5),await c.fromTo(e,{alpha:0},{alpha:1,duration:1,ease:"power2.inOut"}),await new Promise(l=>{c.delayedCall(4,()=>l()),b=()=>l()}),o===n.length-1&&i.isIntroSequencePlaying()&&i.setVisible(!1)}},O=()=>{i.isGameOverScreenVisible()&&(f.visible=!0,c.fromTo(f,{alpha:1},{alpha:0,duration:1,delay:3,ease:"power2.inOut",onComplete:()=>{i.setVisible(!1)}}))};return M(()=>{P(async()=>{if(v(innerWidth,innerHeight),!t.visible&&i.isVisible()){i.isIntroSequencePlaying()&&V(),p.visible=i.isRestScreenVisible(),a.visible=i.isLevelLoadScreenVisible(),O(),x(),g();const e=i.text();e.length>0&&(await C(e),i.setVisible(!1))}else t.visible&&!i.isVisible()&&t.alpha===1&&m()})},t),{view:t,show:g,hide:m,resize:v}};export{G as createLoadingScreenView};
