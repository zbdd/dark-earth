import{w as C,c as b,_ as S,d as p,f as y,U as L}from"./index-9HwvRxxJ.js";var u={},T={},x;function E(){return x||(x=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GRAPH_HEIGHT=e.GRAPH_WIDTH=e.GRAPH_Y=e.FONT_SIZE=e.GRAPH_X=e.TEXT_Y=e.TEXT_X=e.HEIGHT=e.WIDTH=e.PR=void 0,e.PR=4,e.WIDTH=50*e.PR,e.HEIGHT=30*e.PR,e.TEXT_X=7,e.TEXT_Y=7,e.GRAPH_X=e.TEXT_X,e.FONT_SIZE=20,e.GRAPH_Y=e.FONT_SIZE+e.TEXT_Y,e.GRAPH_WIDTH=e.WIDTH-e.GRAPH_X*2,e.GRAPH_HEIGHT=e.HEIGHT-e.GRAPH_X-e.GRAPH_Y}(T)),T}var c={},g;function P(){if(g)return c;g=1,Object.defineProperty(c,"__esModule",{value:!0}),c.Panel=void 0;const e=E();class n{constructor(s,a,t){this.values=[],this.snapshotSize=30;const r=document.createElement("canvas");r.width=e.WIDTH,r.height=e.HEIGHT;const o=r.getContext("2d");if(!o)throw new Error("Cant get context on canvas");o.font=`bold ${e.FONT_SIZE}px ${getComputedStyle(document.body).fontFamily}`,o.textBaseline="top",o.fillStyle=t,o.fillRect(0,0,e.WIDTH,e.HEIGHT),o.fillStyle=a,o.fillText(s,e.TEXT_X,e.TEXT_Y),o.fillRect(e.GRAPH_X,e.GRAPH_Y,e.GRAPH_WIDTH,e.GRAPH_HEIGHT),o.fillStyle=t,o.globalAlpha=.8,o.fillRect(e.GRAPH_X,e.GRAPH_Y,e.GRAPH_WIDTH,e.GRAPH_HEIGHT),this.name=s,this.dom=r,this.context=o,this.fg=a,this.bg=t}get min(){return this.values.reduce((s,a)=>Math.min(s,a),1/0).toFixed()}get max(){return this.values.reduce((s,a)=>Math.max(s,a),0).toFixed()}get averageValue(){return(this.values.reduce((s,a)=>s+a,0)/this.values.length).toFixed(1)}pushValue(s){this.values.push(s),this.values.length>this.snapshotSize&&(this.values=this.values.slice(-this.snapshotSize))}update(s,a){const t=this.context;this.pushValue(s),t.fillStyle=this.bg,t.globalAlpha=1,t.fillRect(0,0,e.WIDTH,e.GRAPH_Y),t.fillStyle=this.fg,t.font=`bold ${e.FONT_SIZE}px ${getComputedStyle(document.body).fontFamily}`,t.fillText(`${this.averageValue} ${this.name} (${this.min}-${this.max})`,e.TEXT_X,e.TEXT_Y),t.drawImage(this.dom,e.GRAPH_X+e.PR,e.GRAPH_Y,e.GRAPH_WIDTH-e.PR,e.GRAPH_HEIGHT,e.GRAPH_X,e.GRAPH_Y,e.GRAPH_WIDTH-e.PR,e.GRAPH_HEIGHT),t.fillRect(e.GRAPH_X+e.GRAPH_WIDTH-e.PR,e.GRAPH_Y,e.PR,e.GRAPH_HEIGHT),t.fillStyle=this.bg,t.globalAlpha=.8,t.fillRect(e.GRAPH_X+e.GRAPH_WIDTH-e.PR,e.GRAPH_Y,2*e.PR,Math.round((1-s/a)*e.GRAPH_HEIGHT))}}return c.Panel=n,c}var _={},w;function D(){if(w)return _;w=1,Object.defineProperty(_,"__esModule",{value:!0}),_.StatsJSAdapter=void 0;const e=P();class n{constructor(s,a){this.hook=s,this.stats=a,this.hook.hooked&&(this.dcPanel=this.stats.addPanel(new e.Panel("DC","#f60","#300")),this.tcPanel=this.stats.addPanel(new e.Panel("TC","#0c6","#033")))}update(){var s,a;this.stats&&(this.hook&&((s=this.dcPanel)===null||s===void 0||s.update(this.hook.deltaDrawCalls,Math.max(50,this.hook.maxDeltaDrawCalls)),(a=this.tcPanel)===null||a===void 0||a.update(this.hook.texturesCount,Math.max(20,this.hook.maxTextureCount))),this.stats.update())}reset(){this.hook&&this.hook.reset()}}return _.StatsJSAdapter=n,_}var f={},h={},d={},m={},G;function X(){if(G)return m;G=1,Object.defineProperty(m,"__esModule",{value:!0});let e=class{constructor(i){this.drawPasses=0,this.isInit=!1,this.realGLDrawElements=function(){},i?i.__proto__.drawElements&&(this.gl=i,this.realGLDrawElements=this.gl.__proto__.drawElements,this.gl.__proto__.drawElements=this.fakeGLdrawElements.bind(this),this.isInit=!0,console.info("[GLHook] GL was Hooked!")):console.warn("[GLHook] GL can't be NULL")}fakeGLdrawElements(i,s,a,t){this.drawPasses++,this.realGLDrawElements.call(this.gl,i,s,a,t)}reset(){this.drawPasses=0}release(){this.isInit&&(this.gl.__proto__.drawElements=this.realGLDrawElements,console.info("[GLHook] Hook was removed!")),this.isInit=!1}};return m.default=e,m}var H={},k;function O(){if(k)return H;k=1,Object.defineProperty(H,"__esModule",{value:!0});let e=class{constructor(i){this.createdTextures=new Array,this.maxTexturesCount=0,this.isInit=!1,this.realGLCreateTexture=function(){},this.realGLDeleteTexture=function(){},i?i.__proto__.createTexture&&(this.gl=i,this.realGLCreateTexture=this.gl.__proto__.createTexture,this.realGLDeleteTexture=this.gl.__proto__.deleteTexture,this.gl.__proto__.createTexture=this.fakeGLCreateTexture.bind(this),this.gl.__proto__.deleteTexture=this.fakeGLDeleteTexture.bind(this),this.isInit=!0,console.info("[TextureHook] GL was Hooked!")):console.warn("[TextureHook] GL can't be NULL")}get currentTextureCount(){return this.createdTextures.length}registerTexture(i){this.createdTextures.push(i),this.maxTexturesCount=Math.max(this.createdTextures.length,this.maxTexturesCount)}fakeGLCreateTexture(){const i=this.realGLCreateTexture.call(this.gl);return this.registerTexture(i),i}fakeGLDeleteTexture(i){const s=this.createdTextures.indexOf(i);s>-1&&this.createdTextures.splice(s,1),this.realGLDeleteTexture.call(this.gl,i)}reset(){this.createdTextures=new Array,this.maxTexturesCount=0}release(){this.isInit&&(this.gl.__proto__.createTexture=this.realGLCreateTexture,this.gl.__proto__.deleteTexture=this.realGLDeleteTexture,console.info("[TextureHook] Hook was removed!")),this.isInit=!1}};return H.default=e,H}var v;function M(){if(v)return d;v=1;var e=d&&d.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(d,"__esModule",{value:!0});const n=e(X()),i=e(O());let s=class{constructor(){this._drawCalls=-1,this._maxDeltaDrawCalls=-1}attach(t){this.glhook=new n.default(t),this.texturehook=new i.default(t)}get drawCalls(){return this.glhook&&this.glhook.isInit?this.glhook.drawPasses:-1}get maxDeltaDrawCalls(){return this._maxDeltaDrawCalls}get deltaDrawCalls(){if(this._drawCalls==-1)return this._drawCalls=this.drawCalls,0;const t=this.drawCalls,r=t-this._drawCalls;return this._drawCalls=t,this._maxDeltaDrawCalls=Math.max(this._maxDeltaDrawCalls,r),r}get maxTextureCount(){return this.texturehook&&this.texturehook.isInit?this.texturehook.maxTexturesCount:0}get texturesCount(){return this.texturehook&&this.texturehook.isInit?this.texturehook.currentTextureCount:0}reset(){this._maxDeltaDrawCalls=-1,this._drawCalls=-1,this.glhook&&this.glhook.reset(),this.texturehook&&this.texturehook.reset()}release(){this.glhook&&this.glhook.release(),this.texturehook&&this.texturehook.release()}};return d.default=s,d}var I;function q(){if(I)return h;I=1;var e=h&&h.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(h,"__esModule",{value:!0}),h.PIXIHooks=void 0;const n=e(M());class i extends n.default{get hooked(){return!!this.glhook}constructor(a){if(super(),!a){console.warn("[PIXI Hooks] renderer in constructor undefined");return}if(!a.gl){console.warn("[PIXI Hooks] gl in renderer not found");return}if(this.attach(a.gl),!this.texturehook){console.warn("[PIXI Hooks] attach hook to gl in renderer failed");return}const t=a.texture,r=t._glTextures||t.managedTextures,o=Array.isArray(r)?r:Object.values(r);if(!o){console.warn("[PIXI Hooks] no gl textures found");return}console.info("[PIXI Hooks] Collect used textures:",o.length),o.forEach(l=>{l.gl===a.gl&&l.texture&&this.texturehook.registerTexture(l.texture)})}}return h.PIXIHooks=i,h}var R;function W(){if(R)return f;R=1,Object.defineProperty(f,"__esModule",{value:!0}),f.Stats=void 0;const e=q(),n=P(),i=D();class s{constructor(t,r=document.body,o){if(this.mode=0,this.frames=0,this.beginTime=(performance||Date).now(),this.prevTime=this.beginTime,this.domElement=document.createElement("div"),this.domElement.id="stats",this.domElement.addEventListener("click",l=>{l.preventDefault(),this.showPanel(++this.mode%this.domElement.children.length)},!1),this.fpsPanel=this.addPanel(new n.Panel("FPS","#3ff","#002")),this.msPanel=this.addPanel(new n.Panel("MS","#0f0","#020")),"memory"in performance&&(this.memPanel=this.addPanel(new n.Panel("MB","#f08","#200"))),this.pixiHooks=new e.PIXIHooks(t),this.adapter=new i.StatsJSAdapter(this.pixiHooks,this),this.showPanel(0),r.appendChild(this.domElement),"animations"in t)t.animations.push(()=>{this.adapter.update()});else if(o)o.add(()=>{this.adapter.update()});else{const l=()=>{this.adapter.update(),requestAnimationFrame(l)};l()}}addPanel(t){return this.domElement.appendChild(t.dom),t}showPanel(t){for(let r=0;r<this.domElement.children.length;r++){const o=this.domElement.children[r];o.style.display=r===t?"block":"none"}this.mode=t}begin(){this.beginTime=(performance||Date).now()}end(){this.frames++;const t=(performance||Date).now();if(this.msPanel.update(t-this.beginTime,200),t>this.prevTime+1e3&&(this.fpsPanel.update(this.frames*1e3/(t-this.prevTime),100),this.prevTime=t,this.frames=0,this.memPanel&&"memory"in performance)){const r=performance.memory;this.memPanel.update(r.usedJSHeapSize/1048576,r.jsHeapSizeLimit/1048576)}return t}update(){this.beginTime=this.end()}}return f.Stats=s,f}var A;function Y(){return A||(A=1,function(e){var n=u&&u.__createBinding||(Object.create?function(s,a,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(a,t);(!o||("get"in o?!a.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return a[t]}}),Object.defineProperty(s,r,o)}:function(s,a,t,r){r===void 0&&(r=t),s[r]=a[t]}),i=u&&u.__exportStar||function(s,a){for(var t in s)t!=="default"&&!Object.prototype.hasOwnProperty.call(a,t)&&n(a,s,t)};Object.defineProperty(e,"__esModule",{value:!0}),i(E(),e),i(P(),e),i(D(),e),i(W(),e)}(u)),u}var j=Y();const z=async e=>{const n=document.getElementById("app");if(n===null)throw new Error("No app element found");const i=document.createElement("div");i.classList.add(C["game-wrapper"]),n.appendChild(i);const s=new b,a=Math.min(window.devicePixelRatio,2)||1;await s.init({width:innerWidth,height:innerHeight,resizeTo:i,resolution:a,autoDensity:!0}),i.appendChild(s.canvas);const t=await S(()=>import("./manifest-CPkY-fOU.js"),[],import.meta.url);if(p.init({basePath:"./1.0.39/",manifest:t}),new FontFace("alagard","url(./1.0.39/fonts/alagard.ttf)").load().then(r=>{document.fonts.add(r)}),await p.loadBundle("default"),e.debug.enablePixiDebug&&(globalThis.__PIXI_APP__=s),innerWidth>1e3&&e.debug.enablePixiStats){const r=new j.Stats(s,n,y.shared);s.ticker.add(r.update,r,L.UTILITY)}return s};export{z as createPixiApp};
