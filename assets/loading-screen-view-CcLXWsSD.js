import{c as y,g as c,S as u}from"./sound-manager-CNiGKKGN.js";import{C as x,S as d,T as C}from"./index-DOAf-07N.js";import{a as I}from"./solid-lwVvZ318.js";const P=b=>{const{viewModel:t}=b,i=new x;let f=()=>{};i.label="loading-screen-view",i.visible=!1,i.eventMode="static",i.on("pointertap",()=>{f()});const s=d.from("load-level.jpg");s.label="loading-screen-sprite";const r=d.from("loading-screen-settlement.jpg");r.label="loading-screen-settlement-sprite",r.visible=t.isRestScreenVisible();const l=[d.from("intro-1.jpg"),d.from("intro-2.jpg"),d.from("intro-3.jpg"),d.from("intro-4.jpg")],n=new C;n.label="loading-screen-title",n.text=t.text(),n.style={fontFamily:"alagard",fontSize:48,fill:"#ffffff",align:"center",stroke:"#000000",dropShadow:!0},n.position.set(s.width*.5-n.width*.5,s.height*.2+n.height*.5),i.addChild(s,n,r),l.forEach((e,a)=>{e.label=`intro-screen-sprite-${a+1}`,e.visible=!1,i.addChild(e)});const m=()=>{t.isRestScreenVisible()?u.playMusic("mx-level-end.wav",{fadeIn:!0,fadeOut:!0}):t.isIntroSequencePlaying()&&u.playMusic("mx-intro.mp3",{fadeIn:!0,fadeOut:!0})},p=()=>{i.alpha=0,i.visible=!0,c.to(i,{alpha:1,duration:r.visible?6:1,ease:"power2.inOut"})},h=()=>{c.to(i,{alpha:0,duration:1,ease:"power2.inOut",onComplete:()=>{i.visible=!1}})},g=(e,a)=>{const o=Math.min(e/s.width,a/s.height);i.scale.set(o),i.position.set((e-s.width*o)*.5,(a-s.height*o)*.5)},S=async e=>{n.text="";const a=e.split("");for(const o of a)n.text+=o,await new Promise(v=>setTimeout(v,100));t.setText(e),await c.delayedCall(1,()=>{})},w=async()=>{for(const e of l){const a=l.indexOf(e);e.visible=!0,e.alpha=0,e.position.set((s.width-e.width)*.5,(s.height-e.height)*.5),await c.to(e,{alpha:1,duration:1,ease:"power2.inOut"}),await new Promise(o=>{c.delayedCall(4,()=>o()),f=()=>o()}),a===l.length-1&&t.isIntroSequencePlaying()&&(t.setIntroSequencePlaying(!1),t.setVisible(!1))}};return y(()=>{I(async()=>{if(g(innerWidth,innerHeight),!i.visible&&t.isVisible()){t.isIntroSequencePlaying()?w():(l.slice(0,3).forEach(a=>a.visible=!1),c.to(l[3],{alpha:0,duration:1,ease:"power2.inOut",onComplete:()=>{l[3].visible=!1}})),r.visible=t.isRestScreenVisible(),s.visible=!r.visible,m(),p();const e=t.text();e.length>0&&(await S(e),t.setVisible(!1))}else i.visible&&!t.isVisible()&&i.alpha===1&&h()})},i),{view:i,show:p,hide:h,resize:g}};export{P as createLoadingScreenView};
