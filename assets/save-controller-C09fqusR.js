import{l as y,a as D,b as I,c as h,d as O,e as E,f as L,G as m}from"./npc-model-DgI3975p.js";import"./solid-lwVvZ318.js";const k=()=>{const r="darkEarth-1.0.39-save",l="darkEarth-1.0.39-log",u=()=>{console.debug("Clearing saved game...");try{const e=localStorage.getItem(l),a=localStorage.getItem(r);e&&localStorage.setItem(`${l}-backup`,e),a&&localStorage.setItem(`${r}-backup`,a)}catch{console.debug("Unable to backup saved game")}try{localStorage.removeItem(r),localStorage.removeItem(l),console.debug("Saved game cleared successfully.")}catch(e){console.error("Error clearing saved game:",e)}},i=()=>{console.debug("Saving game log...");const e=m().log,a=JSON.stringify(e);try{localStorage.setItem(l,a)}catch(t){console.error("Error saving game log:",t)}},v=e=>{console.debug("Saving game...");const{playerModel:a,npcModels:t,eventModels:s,settlementModels:c,tileModels:n,fogOfWarViewModel:g}=e,d=JSON.stringify({playerData:a.data(),npcData:t.map(o=>o.data()),eventData:s.map(o=>o.data()),settlementData:c.map(o=>o.data()),tileData:n.map(o=>o.map(b=>b.data())),fogOfWarData:g.data()});try{localStorage.setItem(r,d)}catch(o){console.error("Error saving game state:",o);return}i(),console.debug("Game saved successfully.")},f=()=>{console.debug("Loading game log...");const e=localStorage.getItem(l);if(!e){console.warn("No saved game log found.");return}try{const a=JSON.parse(e);m().load(a),console.debug("Game log loaded successfully.")}catch(a){console.error("Error loading game log:",a)}},p=()=>(console.debug("Checking if saved game exists..."),localStorage.getItem(r)?(console.debug("Saved game found."),!0):(console.debug("No saved game found."),!1)),S=()=>{console.debug("Loading game...");const e=localStorage.getItem(r);if(!e){console.warn("No saved game state found.");return}try{const a=JSON.parse(e),t=M(a);return console.debug("Game loaded successfully."),f(),t}catch(a){console.error("Error loading game state:",a);return}},M=e=>{const a=y(e.playerData),t=e.npcData.map(D),s=e.eventData.map(I),c=e.settlementData.map(h),n=e.tileData.map(d=>d.map(O)),g=E(e.fogOfWarData);return{playerModel:a,npcModels:t,eventModels:s,settlementModels:c,tileMapModel:L(n),fogOfWarViewModel:g}};return{save:v,load:S,clear:u,saveExists:p}};export{k as createSaveController};
